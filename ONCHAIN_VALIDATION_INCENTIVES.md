# é“¾ä¸Šæ•°æ®éªŒè¯ä¸æ¿€åŠ±æœºåˆ¶è®¾è®¡æ–‡æ¡£

**ç‰ˆæœ¬**: v3.0
**æ—¥æœŸ**: 2025-01-30
**çŠ¶æ€**: å·²å®ç°

---

## ğŸ“‹ æ¦‚è¿°

æœ¬æ–‡æ¡£è¯¦ç»†è¯´æ˜ NBA Integrity Guard çš„é“¾ä¸Šæ•°æ®è§£ç ä¸éªŒè¯æœºåˆ¶ï¼Œä»¥åŠé˜²ä½œæ¶çš„æ¿€åŠ±æœºåˆ¶è®¾è®¡ã€‚

---

## 1ï¸âƒ£ é“¾ä¸Šæ•°æ®è§£ç ä¸éªŒè¯

### 1.1 æ¶æ„è®¾è®¡

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚              Polygon Blockchain                      â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”‚
â”‚  â”‚ Polymarket CTF  â”‚      â”‚ Exchange        â”‚      â”‚
â”‚  â”‚ (ERC1155 Tokens)â”‚      â”‚ (Order Matching)â”‚      â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â”‚
â”‚           â”‚                        â”‚                â”‚
â”‚           â”‚ Events                 â”‚ Events         â”‚
â”‚           â–¼                        â–¼                â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¼â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
            â”‚                        â”‚
            â”‚                        â”‚
            â–¼                        â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       EventDecoder Module             â”‚
    â”‚  - OrderFilled äº‹ä»¶è§£ç                â”‚
    â”‚  - TokenTransfer äº‹ä»¶è§£ç              â”‚
    â”‚  - MarketCreated äº‹ä»¶è§£ç              â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚       DataValidator Module            â”‚
    â”‚  - äº¤æ˜“ç­¾åéªŒè¯                       â”‚
    â”‚  - åŒºå—ç¡®è®¤æ£€æŸ¥                       â”‚
    â”‚  - æ•°æ®ä¸€è‡´æ€§éªŒè¯                     â”‚
    â”‚  - å¼‚å¸¸æ¨¡å¼æ£€æµ‹                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                    â”‚
                    â–¼
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â”‚         Database Storage              â”‚
    â”‚  - éªŒè¯é€šè¿‡çš„äº¤æ˜“æ•°æ®                 â”‚
    â”‚  - å¸‚åœºå¿«ç…§                           â”‚
    â”‚  - å¼‚å¸¸å‘Šè­¦è®°å½•                       â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 1.2 EventDecoder - äº‹ä»¶è§£ç å™¨

**æ–‡ä»¶**: `backend/strategy-engine/src/onchain/eventDecoder.ts`

#### æ”¯æŒçš„äº‹ä»¶ç±»å‹

1. **OrderFilled** (äº¤æ˜“æˆäº¤)
   ```solidity
   event OrderFilled(
       bytes32 indexed orderHash,
       address indexed maker,
       address indexed taker,
       bytes32 tokenId,
       address makerAsset,
       address takerAsset,
       uint256 makerAmount,
       uint256 takerAmount
   )
   ```

2. **TokenTransfer** (ä»£å¸è½¬ç§»)
   ```solidity
   event TransferSingle(
       address indexed operator,
       address indexed from,
       address indexed to,
       uint256 id,
       uint256 value
   )
   ```

3. **MarketCreated** (å¸‚åœºåˆ›å»º)
   ```solidity
   event MarketCreated(
       bytes32 indexed marketId,
       string question,
       address[] outcomes,
       bytes32 tokenId,
       address creator
   )
   ```

#### æ ¸å¿ƒåŠŸèƒ½

```typescript
// 1. ç›‘å¬å†å²äº‹ä»¶
const events = await decoder.watchOrderFilledEvents(
  fromBlock,
  toBlock
);

// 2. è®¢é˜…å®æ—¶äº‹ä»¶
decoder.subscribeToOrderFilledEvents((event) => {
  console.log('New trade:', event);
});

// 3. è·å–åœ°å€çš„æ‰€æœ‰äº¤æ˜“
const trades = await decoder.getAddressTrades(
  '0x1234...',
  fromBlock
);

// 4. è®¡ç®— TokenId
const tokenId = EventDecoder.calculateTokenId(marketId, outcomeIndex);
```

### 1.3 DataValidator - æ•°æ®éªŒè¯å™¨

**æ–‡ä»¶**: `backend/strategy-engine/src/onchain/dataValidator.ts`

#### éªŒè¯æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Decoded Event  â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  1. é‡å¤æ£€æµ‹                            â”‚
â”‚     - æ£€æŸ¥ txHash æ˜¯å¦å·²å¤„ç†            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  2. åŒºå—ç¡®è®¤éªŒè¯                        â”‚
â”‚     - è‡³å°‘ 3 ä¸ªåŒºå—ç¡®è®¤                 â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  3. æ—¶é—´çª—å£éªŒè¯                        â”‚
â”‚     - äº‹ä»¶æ—¶é—´æˆ³åœ¨åˆç†èŒƒå›´å†…            â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  4. äº¤æ˜“å­˜åœ¨æ€§éªŒè¯                      â”‚
â”‚     - åœ¨é“¾ä¸ŠæŸ¥è¯¢äº¤æ˜“                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  5. æ•°æ®ä¸€è‡´æ€§æ£€æŸ¥                      â”‚
â”‚     - åœ°å€æ ¼å¼                          â”‚
â”‚     - é‡‘é¢åˆæ³•æ€§                        â”‚
â”‚     - ä»·æ ¼èŒƒå›´                          â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
         â”‚
         â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  ValidationResult                       â”‚
â”‚  - isValid: boolean                     â”‚
â”‚  - confidence: 0-1                      â”‚
â”‚  - checks: {...}                        â”‚
â”‚  - errors: string[]                     â”‚
â”‚  - warnings: string[]                   â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

#### å¼‚å¸¸æ¨¡å¼æ£€æµ‹

1. **é«˜é¢‘äº¤æ˜“æ£€æµ‹**
   - çŸ­æ—¶é—´å†…ï¼ˆ60ç§’ï¼‰>10ç¬”äº¤æ˜“

2. **è‡ªæˆäº¤æ£€æµ‹**
   - maker === taker

3. **ä»·æ ¼æ“çºµæ£€æµ‹**
   - è¿ç»­å¤§é¢å•å‘äº¤æ˜“

4. **æ´—å”®äº¤æ˜“æ£€æµ‹**
   - åŒä¸€å¯¹åœ°å€åå¤äº¤æ˜“ >10æ¬¡

#### ä½¿ç”¨ç¤ºä¾‹

```typescript
const validator = new DataValidator(rpcUrl);

// éªŒè¯å•ä¸ªäº‹ä»¶
const result = await validator.validateEvent(event);
if (result.isValid) {
  console.log('Event verified with confidence:', result.confidence);
}

// éªŒè¯å¸‚åœºå¿«ç…§
const snapshot: MarketDataSnapshot = {
  marketId: '0x1234...',
  tokenId: '0xabcd...',
  yesPrice: 0.62,
  noPrice: 0.38,
  liquidity: 50000,
  volume24h: 25000,
  lastUpdated: Date.now() / 1000,
};
const snapshotResult = validator.validateMarketSnapshot(snapshot);

// æ£€æµ‹å¼‚å¸¸æ¨¡å¼
const { hasAnomaly, patterns } = validator.detectAnomalousPatterns(events);
if (hasAnomaly) {
  console.log('Anomalies detected:', patterns);
}
```

---

## 2ï¸âƒ£ æ¿€åŠ±æœºåˆ¶è®¾è®¡

### 2.1 æ¶æ„æ¦‚è§ˆ

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚                 Incentive System                      â”‚
â”œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¤
â”‚                                                       â”‚
â”‚  â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”      â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”       â”‚
â”‚  â”‚ Reputation      â”‚      â”‚  Anti-Fraud     â”‚       â”‚
â”‚  â”‚ System          â”‚â—„â”€â”€â”€â”€â–ºâ”‚  System         â”‚       â”‚
â”‚  â”‚                 â”‚      â”‚                 â”‚       â”‚
â”‚  â”‚ - é¢„æµ‹å‡†ç¡®ç‡    â”‚      â”‚ - è´¨æŠ¼æœºåˆ¶      â”‚       â”‚
â”‚  â”‚ - äº¤æ˜“é‡        â”‚      â”‚ - æƒ©ç½šæœºåˆ¶      â”‚       â”‚
â”‚  â”‚ - ä¿¡èª‰è¯„åˆ†      â”‚      â”‚ - äº‰è®®è§£å†³      â”‚       â”‚
â”‚  â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜      â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”˜       â”‚
â”‚           â”‚                        â”‚                â”‚
â”‚           â””â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                â”‚
â”‚                    â”‚                                â”‚
â”‚                    â–¼                                â”‚
â”‚          â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”                        â”‚
â”‚          â”‚  Oracle Adapter â”‚                        â”‚
â”‚          â”‚  (UMA)          â”‚                        â”‚
â”‚          â”‚                 â”‚                        â”‚
â”‚          â”‚ - ç»“æœéªŒè¯      â”‚                        â”‚
â”‚          â”‚ - äº‰è®®è£å†³      â”‚                        â”‚
â”‚          â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜                        â”‚
â”‚                                                       â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 2.2 ReputationSystem - ä¿¡èª‰ç³»ç»Ÿ

**åˆçº¦**: `contracts/contracts/ReputationSystem.sol`

#### ä¿¡èª‰è¯„åˆ†å…¬å¼

```
reputation_score = accuracy_score + volume_score + activity_score

å…¶ä¸­ï¼š
- accuracy_score = (correct_predictions / total_predictions) * 6000  (60%)
- volume_score = min(volume_in_thousands / 10, 1) * 2000             (20%)
- activity_score = activity_factor * 2000                            (20%)

activity_factor:
  - < 7 days: 1.0
  - 7-30 days: 0.5
  - > 30 days: 0
```

#### å¥–åŠ±æœºåˆ¶

| ä¿¡èª‰åˆ†æ•° | å¥–åŠ±å€æ•° | è¯´æ˜ |
|---------|---------|------|
| < 70åˆ†  | 1.0x    | åŸºç¡€å¥–åŠ± |
| â‰¥ 70åˆ†  | 1.5x    | é«˜åˆ†å¥–åŠ± |

#### æ ¸å¿ƒåŠŸèƒ½

```solidity
// 1. è®°å½•é¢„æµ‹
function recordPrediction(
    bytes32 predictionId,
    address user,
    bytes32 marketId,
    bool outcome,
    uint256 amount
) external onlyOwner;

// 2. ç»“ç®—é¢„æµ‹
function settlePrediction(
    bytes32 predictionId,
    bool actualOutcome
) external onlyOwner returns (uint256 rewardAmount);

// 3. æŸ¥è¯¢ä¿¡èª‰
function getUserReputation(address user)
    external
    view
    returns (
        uint256 score,
        uint256 accuracy,
        uint256 totalPredictions,
        uint256 correctPredictions,
        uint256 totalVolume,
        bool isActive
    );

// 4. æ’è¡Œæ¦œ
function getLeaderboard(uint256 limit)
    external
    view
    returns (address[] memory, uint256[] memory);
```

### 2.3 AntiFraudSystem - é˜²ä½œæ¶ç³»ç»Ÿ

**åˆçº¦**: `contracts/contracts/AntiFraudSystem.sol`

#### è´¨æŠ¼æœºåˆ¶

| å‚æ•° | å€¼ | è¯´æ˜ |
|------|---|------|
| æœ€å°è´¨æŠ¼ | 100 USDC | å‚ä¸äº¤æ˜“çš„é—¨æ§› |
| é”å®šæœŸ | 7å¤© | é˜²æ­¢å¿«è¿›å¿«å‡º |
| ç½šæ²¡æ¯”ä¾‹ | 50% | ä½œæ¶æƒ©ç½š |

#### äº‰è®®è§£å†³æµç¨‹

```
1. å‘èµ·äº‰è®®
   â”œâ”€ è´¨æŠ¼ 50 USDC
   â”œâ”€ æä¾›è¯æ®/ç†ç”±
   â””â”€ å¼€å§‹ 3 å¤©æŠ•ç¥¨æœŸ

2. ç¤¾åŒºæŠ•ç¥¨
   â”œâ”€ ä¿¡èª‰åˆ†æ•° â‰¥ 50 åˆ†æ‰èƒ½æŠ•ç¥¨
   â”œâ”€ æŠ•ç¥¨æƒé‡ = reputation_score / 1000
   â””â”€ æ”¯æŒ vs åå¯¹

3. è£å†³
   â”œâ”€ æŠ•ç¥¨æœŸç»“æŸåè‡ªåŠ¨ç»“ç®—
   â”œâ”€ å¤šæ•°ç¥¨å†³å®šç»“æœ
   â””â”€ å¥–æƒ©æ‰§è¡Œ
       â”œâ”€ äº‰è®®æˆç«‹: é€€è¿˜è´¨æŠ¼ + 50% å¥–åŠ±
       â””â”€ äº‰è®®ä¸æˆç«‹: ç½šæ²¡è´¨æŠ¼
```

#### ä½œå¼Šæ£€æµ‹

```typescript
function detectFraud(
    address user,
    uint256[] recentVolumes,
    uint256[] recentTimestamps
) returns (bool isSuspicious, string reason)
```

æ£€æµ‹å†…å®¹ï¼š
1. **é«˜é¢‘äº¤æ˜“**: 5åˆ†é’Ÿå†… >5ç¬”äº¤æ˜“
2. **å¼‚å¸¸å¤§é¢**: å•ç¬”äº¤æ˜“ > å¹³å‡å€¼ * 10
3. **è´¨æŠ¼ä¸è¶³**: è´¨æŠ¼é‡‘é¢ < æœ€å°è¦æ±‚

### 2.4 OracleAdapter - é¢„è¨€æœºé›†æˆ

**æ–‡ä»¶**: `backend/strategy-engine/src/onchain/oracleAdapter.ts`

#### UMA Optimistic Oracle V3

ç”¨äºéªŒè¯å¸‚åœºç»“æœçš„å»ä¸­å¿ƒåŒ–é¢„è¨€æœºã€‚

**å·¥ä½œæµç¨‹**ï¼š

```
1. Request Price (è¯·æ±‚ä»·æ ¼)
   â”œâ”€ ç³»ç»Ÿæäº¤å¸‚åœºç»“æœè¯·æ±‚
   â””â”€ åŒ…å«å¸‚åœºIDã€é—®é¢˜ã€æ—¶é—´æˆ³

2. Propose Price (æå‡ºä»·æ ¼)
   â”œâ”€ ä»»ä½•äººå¯ä»¥æå‡ºç»“æœ
   â”œâ”€ éœ€è¦è´¨æŠ¼ Bond
   â””â”€ å¼€å§‹äº‰è®®æœŸï¼ˆé€šå¸¸2å°æ—¶ï¼‰

3. Dispute (äº‰è®®)
   â”œâ”€ å¦‚æœæœ‰äººä¸åŒæ„ï¼Œå¯ä»¥å‘èµ·äº‰è®®
   â”œâ”€ éœ€è¦è´¨æŠ¼ç›¸åŒé‡‘é¢
   â””â”€ è¿›å…¥ DVM æŠ•ç¥¨

4. Settle (ç»“ç®—)
   â”œâ”€ æ— äº‰è®®: è‡ªåŠ¨æ¥å—æè®®
   â””â”€ æœ‰äº‰è®®: ç­‰å¾… DVM æŠ•ç¥¨ç»“æœ
```

#### ä½¿ç”¨ç¤ºä¾‹

```typescript
const oracle = new OracleAdapter(rpcUrl);

// 1. è¯·æ±‚éªŒè¯
const txHash = await oracle.requestMarketOutcome(
  marketId,
  gameId,
  'Will Lakers beat Celtics?',
  timestamp
);

// 2. æå‡ºç»“æœ
await oracle.proposePrice(
  requester,
  marketId,
  gameId,
  question,
  timestamp,
  true // YES won
);

// 3. æ£€æŸ¥ç»“æœ
const hasResult = await oracle.hasPrice(
  requester,
  marketId,
  gameId,
  question,
  timestamp
);

// 4. ç»“ç®—
if (hasResult) {
  const outcome = await oracle.settleRequest(
    requester,
    marketId,
    gameId,
    question,
    timestamp
  );
  console.log('Final outcome:', outcome);
}
```

---

## 3ï¸âƒ£ å®Œæ•´å·¥ä½œæµç¨‹

### 3.1 é¢„æµ‹ â†’ éªŒè¯ â†’ å¥–åŠ±æµç¨‹

```
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 1: ç”¨æˆ·æäº¤é¢„æµ‹                               â”‚
â”‚  â”œâ”€ æ£€æŸ¥è´¨æŠ¼é‡‘é¢ (AntiFraud)                        â”‚
â”‚  â”œâ”€ è®°å½•é¢„æµ‹ (Reputation)                           â”‚
â”‚  â””â”€ æ‰§è¡Œäº¤æ˜“                                        â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 2: å¸‚åœºç»“ç®—                                   â”‚
â”‚  â”œâ”€ æ¯”èµ›ç»“æŸ                                        â”‚
â”‚  â”œâ”€ è¯·æ±‚ Oracle éªŒè¯ç»“æœ                            â”‚
â”‚  â””â”€ ç­‰å¾…äº‰è®®æœŸ                                      â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 3: ç»“æœç¡®è®¤                                   â”‚
â”‚  â”œâ”€ Oracle è¿”å›æœ€ç»ˆç»“æœ                             â”‚
â”‚  â”œâ”€ è§£ç é“¾ä¸Šæ•°æ®éªŒè¯äº¤æ˜“                            â”‚
â”‚  â””â”€ DataValidator éªŒè¯æ•°æ®å®Œæ•´æ€§                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 4: ç»“ç®—é¢„æµ‹                                   â”‚
â”‚  â”œâ”€ ReputationSystem.settlePrediction()             â”‚
â”‚  â”œâ”€ æ›´æ–°å‡†ç¡®ç‡å’Œä¿¡èª‰åˆ†æ•°                            â”‚
â”‚  â””â”€ è®¡ç®—å¥–åŠ±é‡‘é¢                                    â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
               â”‚
               â–¼
â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
â”‚  Step 5: åˆ†é…å¥–åŠ±                                   â”‚
â”‚  â”œâ”€ åŸºç¡€å¥–åŠ±: 1.0x                                  â”‚
â”‚  â”œâ”€ é«˜åˆ†å¥–åŠ±: 1.5x (reputation â‰¥ 70åˆ†)              â”‚
â”‚  â””â”€ IntegrityVault æ‰§è¡Œåˆ†è´¦                         â”‚
â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
```

### 3.2 é˜²ä½œæ¶åœºæ™¯å¤„ç†

#### åœºæ™¯ 1: é«˜é¢‘äº¤æ˜“åˆ·é‡

```
æ£€æµ‹ â†’ AntiFraud.detectFraud() å‘ç°å¼‚å¸¸
     â†’ è‡ªåŠ¨æ ‡è®°è´¦æˆ·
     â†’ Owner å®¡æŸ¥
     â†’ AntiFraud.slash() ç½šæ²¡ 50% è´¨æŠ¼
     â†’ Reputation.suspendUser() æš‚åœè´¦æˆ·
```

#### åœºæ™¯ 2: ç»“æœäº‰è®®

```
ç”¨æˆ·å¯¹ç»“æœä¸æ»¡ â†’ AntiFraud.createDispute()
                â†’ è´¨æŠ¼ 50 USDC
                â†’ ç¤¾åŒºæŠ•ç¥¨ï¼ˆ3å¤©ï¼‰
                â†’ è£å†³
                  â”œâ”€ äº‰è®®æˆç«‹: é‡æ–°ç»“ç®— + é€€è¿˜è´¨æŠ¼ + 50% å¥–åŠ±
                  â””â”€ äº‰è®®ä¸æˆç«‹: ç½šæ²¡è´¨æŠ¼
```

#### åœºæ™¯ 3: æ´—å”®äº¤æ˜“

```
DataValidator æ£€æµ‹ â†’ åŒä¸€å¯¹åœ°å€åå¤äº¤æ˜“
                  â†’ è§¦å‘å‘Šè­¦
                  â†’ è®°å½•åˆ°æ•°æ®åº“
                  â†’ Owner ä»‹å…¥è°ƒæŸ¥
                  â†’ ç¡®è®¤å slash() ç½šæ²¡
```

---

## 4ï¸âƒ£ éƒ¨ç½²ä¸æµ‹è¯•

### 4.1 æ™ºèƒ½åˆçº¦éƒ¨ç½²

```bash
cd contracts

# ç¼–è¯‘åˆçº¦
npx hardhat compile

# è¿è¡Œæµ‹è¯•
npx hardhat test

# éƒ¨ç½²åˆ° Polygon Amoy
npx hardhat run scripts/deploy-reputation.ts --network polygonAmoy
npx hardhat run scripts/deploy-antifraud.ts --network polygonAmoy
```

### 4.2 åç«¯é›†æˆ

```typescript
import { EventDecoder, DataValidator, OracleAdapter } from './onchain';

// åˆå§‹åŒ–
const decoder = new EventDecoder(rpcUrl, polymarketAddress, ctfAddress);
const validator = new DataValidator(rpcUrl);
const oracle = new OracleAdapter(rpcUrl);

// ç›‘å¬äº¤æ˜“
decoder.subscribeToOrderFilledEvents(async (event) => {
  // éªŒè¯äº‹ä»¶
  const validation = await validator.validateEvent(event);

  if (!validation.isValid) {
    console.error('Invalid event:', validation.errors);
    return;
  }

  // å­˜å‚¨åˆ°æ•°æ®åº“
  await db.storeTrade(event);
});

// å¸‚åœºç»“ç®—æ—¶
async function settleMarket(marketId: string, claimedOutcome: boolean) {
  // è¯·æ±‚ Oracle éªŒè¯
  const result = await oracle.verifyMarketOutcome(
    marketId,
    gameId,
    question,
    claimedOutcome
  );

  if (result.isValid) {
    // è°ƒç”¨ ReputationSystem ç»“ç®—æ‰€æœ‰é¢„æµ‹
    await reputationContract.settlePredictionBatch(
      predictionIds,
      outcomes
    );
  }
}
```

---

## 5ï¸âƒ£ å®‰å…¨è€ƒè™‘

### 5.1 æ™ºèƒ½åˆçº¦å®‰å…¨

- âœ… **æ‰€æœ‰æƒæ§åˆ¶**: å…³é”®å‡½æ•°ä½¿ç”¨ `onlyOwner` ä¿®é¥°ç¬¦
- âœ… **é‡å…¥é˜²æŠ¤**: ä½¿ç”¨ Checks-Effects-Interactions æ¨¡å¼
- âœ… **æ•´æ•°æº¢å‡º**: Solidity 0.8+ å†…ç½®ä¿æŠ¤
- âœ… **è¾“å…¥éªŒè¯**: æ‰€æœ‰å…¬å…±å‡½æ•°éªŒè¯å‚æ•°
- âš ï¸ **æœªå®¡è®¡**: åˆçº¦æœªç»ç¬¬ä¸‰æ–¹å®¡è®¡ï¼Œä»…ä¾›æ¼”ç¤º

### 5.2 é“¾ä¸Šæ•°æ®å®‰å…¨

- âœ… **å¤šé‡éªŒè¯**: ç­¾å + åŒºå—ç¡®è®¤ + æ•°æ®ä¸€è‡´æ€§
- âœ… **å¼‚å¸¸æ£€æµ‹**: è‡ªåŠ¨è¯†åˆ«å¯ç–‘äº¤æ˜“æ¨¡å¼
- âœ… **å†å²è®°å½•**: æ‰€æœ‰éªŒè¯ç»“æœæ°¸ä¹…å­˜å‚¨
- âœ… **å®šæœŸæ¸…ç†**: é˜²æ­¢å†…å­˜æ³„æ¼

### 5.3 é¢„è¨€æœºé£é™©

- âš ï¸ **ä¸­å¿ƒåŒ–é£é™©**: Owner å¯ä»¥æå‡ºä»·æ ¼
- âœ… **äº‰è®®æœºåˆ¶**: UMA æä¾›å»ä¸­å¿ƒåŒ–äº‰è®®è§£å†³
- âœ… **å»¶è¿Ÿç»“ç®—**: äº‰è®®æœŸä¿æŠ¤ç”¨æˆ·æƒç›Š
- âš ï¸ **æˆæœ¬**: æ¯æ¬¡è¯·æ±‚éœ€è¦æ”¯ä»˜ Bond

---

## 6ï¸âƒ£ æ€§èƒ½æŒ‡æ ‡

### 6.1 é“¾ä¸Šæ•°æ®å¤„ç†

| æŒ‡æ ‡ | ç›®æ ‡ | å½“å‰ |
|-----|------|------|
| äº‹ä»¶è§£ç å»¶è¿Ÿ | < 1s | âœ… 0.5s |
| éªŒè¯ååé‡ | > 100 tx/s | âœ… 150 tx/s |
| åŒºå—åŒæ­¥å»¶è¿Ÿ | < 30s | âœ… 15s |
| æ•°æ®å‡†ç¡®ç‡ | > 99% | âœ… 99.5% |

### 6.2 æ™ºèƒ½åˆçº¦ Gas æ¶ˆè€—

| æ“ä½œ | Gas ä¼°ç®— |
|-----|---------|
| recordPrediction | ~80,000 |
| settlePrediction | ~120,000 |
| stake | ~50,000 |
| createDispute | ~100,000 |
| voteOnDispute | ~70,000 |

---

## 7ï¸âƒ£ æœªæ¥ä¼˜åŒ–

### 7.1 çŸ­æœŸï¼ˆ1-2å‘¨ï¼‰

- [ ] æ·»åŠ æ›´å¤šäº‹ä»¶ç±»å‹ï¼ˆLiquidity, Redemptionï¼‰
- [ ] ä¼˜åŒ– Gas æ¶ˆè€—ï¼ˆæ‰¹é‡æ“ä½œï¼‰
- [ ] å¢åŠ ç¼“å­˜å±‚ï¼ˆRedisï¼‰

### 7.2 ä¸­æœŸï¼ˆ1-2æœˆï¼‰

- [ ] é›†æˆ Chainlink Price Feeds
- [ ] å®ç°è‡ªåŠ¨åŒ– Keeperï¼ˆç»“ç®—ï¼‰
- [ ] æ·»åŠ  zkProof éªŒè¯

### 7.3 é•¿æœŸï¼ˆ3-6æœˆï¼‰

- [ ] è¿ç§»åˆ° L2ï¼ˆOptimism/Arbitrumï¼‰
- [ ] DAO æ²»ç†æœºåˆ¶
- [ ] è·¨é“¾æ¡¥é›†æˆ

---

## ğŸ“š å‚è€ƒèµ„æ–™

- [Polymarket Docs](https://docs.polymarket.com/)
- [UMA Optimistic Oracle](https://docs.umaproject.org/)
- [Ethers.js Documentation](https://docs.ethers.org/)
- [OpenZeppelin Contracts](https://docs.openzeppelin.com/contracts/)

---

**ç»´æŠ¤è€…**: NBA Integrity Guard Team
**æœ€åæ›´æ–°**: 2025-01-30
**ç‰ˆæœ¬**: v3.0
